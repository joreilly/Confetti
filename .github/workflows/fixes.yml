name: Fixes

on:
  workflow_dispatch: {}

jobs:
  build-android:
    runs-on: ubuntu-22.04

    permissions:
      # Give the default GITHUB_TOKEN write permission to commit and push the
      # added or changed files to the repository.
      contents: write
      
    steps:
    - uses: actions/checkout@v4
      with:
        ref: ${{ github.head_ref }}
        lfs: 'true'

    - uses: actions/setup-java@v4
      with:
        distribution: 'zulu'
        java-version: 17

    - name: Setup Gradle
      uses: gradle/gradle-build-action@v3.2.1

    - name: Fix Screenshots
      run: ./gradlew :wearApp:verifyAndRecordRoborazziDebug
      id: screenshotsverify
      continue-on-error: true

    - name: LFS workaround
      run: git config lfs.locksverify false      

    - name: Commit Screenshots
      uses: 'stefanzweifel/git-auto-commit-action@v5'
      if: steps.screenshotsverify.outcome == 'failure'
      with:
        commit_message: 'ðŸ¤– Updates screenshots'
        file_pattern: '**/snapshot/**/*.png'
        disable_globbing: 'true'
